---
alwaysApply: true
---
# üêª Zustand State Management - –ü—Ä–∞–≤–∏–ª–∞ –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

> **–§–∏–ª–æ—Å–æ—Ñ–∏—è**: –ü—Ä–æ—Å—Ç–æ–µ, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Zustand
- **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –¥–∞–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: —Ç–µ–º–∞, —è–∑—ã–∫, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- **–ö—ç—à –¥–∞–Ω–Ω—ã—Ö**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã API –∑–∞–ø—Ä–æ—Å–æ–≤
- **UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, —Å–∞–π–¥–±–∞—Ä—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **–§–æ—Ä–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: —Å–ª–æ–∂–Ω—ã–µ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ —Ñ–æ—Ä–º—ã

### ‚ùå –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑—É–π `useState`
- **–°–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑—É–π React Query/SWR
- **–ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º—ã**: –∏—Å–ø–æ–ª—å–∑—É–π React Hook Form
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ UI —Å–æ—Å—Ç–æ—è–Ω–∏—è**: loading, hover, focus

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–æ—Ä–∞

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ stores/
‚îÇ       ‚îú‚îÄ‚îÄ index.ts          # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ types.ts          # –û–±—â–∏–µ —Ç–∏–ø—ã
‚îÇ       ‚îú‚îÄ‚îÄ theme-store.ts    # –¢–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ user-store.ts     # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ       ‚îú‚îÄ‚îÄ ui-store.ts       # UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ settings-store.ts # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
```

### üé® –ü–∞—Ç—Ç–µ—Ä–Ω —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–æ—Ä–∞
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
import { create } from 'zustand'
import { devtools, persist } from 'zustand/middleware'
import { immer } from 'zustand/middleware/immer'

interface ThemeState {
  // State
  theme: 'light' | 'dark' | 'system'
  isLoading: boolean
  
  // Actions
  setTheme: (theme: 'light' | 'dark' | 'system') => void
  toggleTheme: () => void
  initializeTheme: () => Promise<void>
}

export const useThemeStore = create<ThemeState>()()
  devtools(
    persist(
      immer((set, get) => ({
        // Initial state
        theme: 'system',
        isLoading: false,
        
        // Actions
        setTheme: (theme) => {
          set((state) => {
            state.theme = theme
          })
        },
        
        toggleTheme: () => {
          const { theme } = get()
          const newTheme = theme === 'light' ? 'dark' : 'light'
          get().setTheme(newTheme)
        },
        
        initializeTheme: async () => {
          set((state) => {
            state.isLoading = true
          })
          
          try {
            // –õ–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const savedTheme = localStorage.getItem('theme')
            if (savedTheme) {
              get().setTheme(savedTheme as any)
            }
          } finally {
            set((state) => {
              state.isLoading = false
            })
          }
        }
      })),
      {
        name: 'theme-storage',
        partialize: (state) => ({ theme: state.theme })
      }
    ),
    { name: 'theme-store' }
  )
```

---

## üîß Middleware –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### üì¶ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ middleware
```typescript
// devtools - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ Redux DevTools
// persist - –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
// immer - –¥–ª—è –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

export const useStore = create<State>()()
  devtools(
    persist(
      immer((set, get) => ({
        // store implementation
      })),
      { name: 'store-name' }
    ),
    { name: 'store-debug-name' }
  )
```

### üéØ –°–µ–ª–µ–∫—Ç–æ—Ä—ã –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
const theme = useThemeStore((state) => state.theme)
const setTheme = useThemeStore((state) => state.setTheme)

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤–µ—Å—å —Å—Ç–æ—Ä
const { theme, setTheme, isLoading } = useThemeStore()

// ‚úÖ –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
const useThemeSelector = () => {
  return useThemeStore(
    useCallback(
      (state) => ({
        isDark: state.theme === 'dark',
        isLight: state.theme === 'light',
        isSystem: state.theme === 'system'
      }),
      []
    ),
    shallow
  )
}
```

---

## üé® –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üîÑ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
```typescript
interface ApiState {
  data: any[]
  loading: boolean
  error: string | null
  
  fetchData: () => Promise<void>
  clearError: () => void
}

export const useApiStore = create<ApiState>()()
  devtools(
    immer((set, get) => ({
      data: [],
      loading: false,
      error: null,
      
      fetchData: async () => {
        set((state) => {
          state.loading = true
          state.error = null
        })
        
        try {
          const response = await fetch('/api/data')
          const data = await response.json()
          
          set((state) => {
            state.data = data
            state.loading = false
          })
        } catch (error) {
          set((state) => {
            state.error = error.message
            state.loading = false
          })
        }
      },
      
      clearError: () => {
        set((state) => {
          state.error = null
        })
      }
    }))
  )
```

### üé≠ UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```typescript
interface UiState {
  modals: {
    isContactOpen: boolean
    isMenuOpen: boolean
  }
  notifications: Notification[]
  
  openModal: (modal: keyof UiState['modals']) => void
  closeModal: (modal: keyof UiState['modals']) => void
  addNotification: (notification: Omit<Notification, 'id'>) => void
  removeNotification: (id: string) => void
}

export const useUiStore = create<UiState>()()
  devtools(
    immer((set) => ({
      modals: {
        isContactOpen: false,
        isMenuOpen: false
      },
      notifications: [],
      
      openModal: (modal) => {
        set((state) => {
          state.modals[modal] = true
        })
      },
      
      closeModal: (modal) => {
        set((state) => {
          state.modals[modal] = false
        })
      },
      
      addNotification: (notification) => {
        set((state) => {
          state.notifications.push({
            ...notification,
            id: crypto.randomUUID()
          })
        })
      },
      
      removeNotification: (id) => {
        set((state) => {
          state.notifications = state.notifications.filter(n => n.id !== id)
        })
      }
    })),
    { name: 'ui-store' }
  )
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ—Ä–æ–≤
```typescript
// tests/stores/theme-store.test.ts
import { renderHook, act } from '@testing-library/react'
import { useThemeStore } from '@/lib/stores/theme-store'

describe('ThemeStore', () => {
  beforeEach(() => {
    useThemeStore.setState({ theme: 'system', isLoading: false })
  })
  
  it('should set theme correctly', () => {
    const { result } = renderHook(() => useThemeStore())
    
    act(() => {
      result.current.setTheme('dark')
    })
    
    expect(result.current.theme).toBe('dark')
  })
  
  it('should toggle theme', () => {
    const { result } = renderHook(() => useThemeStore())
    
    act(() => {
      result.current.setTheme('light')
    })
    
    act(() => {
      result.current.toggleTheme()
    })
    
    expect(result.current.theme).toBe('dark')
  })
})
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
```typescript
// ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
const Component = () => {
  const theme = useThemeStore((state) => state.theme)
  const setTheme = useThemeStore((state) => state.setTheme)
  
  return (
    <button onClick={() => setTheme('dark')}>
      Current: {theme}
    </button>
  )
}

// ‚úÖ Shallow comparison –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
import { shallow } from 'zustand/shallow'

const Component = () => {
  const { theme, isLoading } = useThemeStore(
    (state) => ({ theme: state.theme, isLoading: state.isLoading }),
    shallow
  )
  
  return <div>{theme} - {isLoading ? 'Loading...' : 'Ready'}</div>
}
```

### üéØ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–≤
```typescript
// ‚úÖ –†–∞–∑–¥–µ–ª—è–π –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// theme-store.ts - —Ç–æ–ª—å–∫–æ —Ç–µ–º–∞
// user-store.ts - —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
// ui-store.ts - —Ç–æ–ª—å–∫–æ UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ

// ‚ùå –ù–µ —Å–æ–∑–¥–∞–≤–∞–π –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Å—Ç–æ—Ä
// app-store.ts - –≤—Å–µ –≤ –æ–¥–Ω–æ–º (–ø–ª–æ—Ö–æ)
```

---

## üîí TypeScript –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### üìù –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
```typescript
// types.ts
export interface User {
  id: string
  name: string
  email: string
  role: 'admin' | 'user'
}

export interface Notification {
  id: string
  type: 'success' | 'error' | 'warning' | 'info'
  message: string
  duration?: number
}

// –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã –≤ —Å—Ç–æ—Ä–∞—Ö
interface UserState {
  user: User | null
  isAuthenticated: boolean
  
  setUser: (user: User) => void
  logout: () => void
}
```

### üé® –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
```typescript
// hooks/use-theme-selector.ts
export const useThemeSelector = <T>(
  selector: (state: ThemeState) => T
): T => {
  return useThemeStore(selector)
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const isDark = useThemeSelector((state) => state.theme === 'dark')
```

---

## üìö –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ DO
- –ò—Å–ø–æ–ª—å–∑—É–π TypeScript –¥–ª—è –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–≤
- –ü—Ä–∏–º–µ–Ω—è–π middleware (devtools, persist, immer)
- –°–æ–∑–¥–∞–≤–∞–π —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–π –∫—Ä–∏—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É —Å—Ç–æ—Ä–æ–≤
- –†–∞–∑–¥–µ–ª—è–π —Å—Ç–æ—Ä –ø–æ –¥–æ–º–µ–Ω–∞–º
- –ò—Å–ø–æ–ª—å–∑—É–π shallow comparison –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Å–ª–æ–∂–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### ‚ùå DON'T
- –ù–µ —Ö—Ä–∞–Ω–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ Zustand
- –ù–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –Ω–∞ –≤–µ—Å—å —Å—Ç–æ—Ä –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ù–µ —Å–æ–∑–¥–∞–≤–∞–π –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Å—Ç–æ—Ä
- –ù–µ –º—É—Ç–∏—Ä—É–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é (–∏—Å–ø–æ–ª—å–∑—É–π immer)
- –ù–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ cleanup –≤ useEffect
- –ù–µ —Ö—Ä–∞–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö UI —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Zustand Documentation](https://zustand-demo.pmnd.rs/)
- [Zustand Best Practices](https://github.com/pmndrs/zustand/wiki/Best-Practices)
- [TypeScript Guide](https://github.com/pmndrs/zustand#typescript)
- [Testing Guide](https://github.com/pmndrs/zustand#testing)
- [Performance Tips](https://github.com/pmndrs/zustand#performance)

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: –î–µ–∫–∞–±—Ä—å 2024*